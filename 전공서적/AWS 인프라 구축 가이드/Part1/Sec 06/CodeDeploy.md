# **CodeDelpoy에 대하여 (+실습)**

## **CodeDeploy란 ? ? ?**

AWS에서 제공하는 **배포 자동화 서비스**이다. EC2 인스턴스들에 코드를 배포하는 과정을 자동으로 진행해준다.

AWS에서 제공하는 서비스이므로 **AWS 내 다양한 서비스와 손쉽게 연동**해서 사용할 수 있다는 장점이 있으며, CodeDeploy는 **무중단 배포 기법들**인 현재 위치 배포와 블루/그린 배포 방식을 모드 **지원**한다.

<br>

## **CodeDeploy 실습**

이번 실습에서는 현재 위치 배포를 진행하려고 한다.

**[진행과정]**

1) CodeDelploy라는 서비스와 자동으로 배포가 진행될 EC2 인스턴스에게 배포를 진행하는데 필요한 권한을 부여하기 위해 서비스 역할들을 생성.

2) AMI 생성용 EC2 인스턴스에 CodeDeploy Agent 설치 및 환경 구성 작업.

3) 2번 인스턴스를 이용해 새로운 AMI와 시작 템플릿 생성.

4) 3번 시작 템플릿을 이용해 Auto Scaling group에 여러 대의 인스턴스를 실행시킨뒤 새 인스턴스에 새로운 버전의 코드를 배포.

위와 같은 순서대로 실습을 진행하겠다.

<br>

### **CodeDeploy를 위한 서비스 역할 생성**
**[진행과정]**

1) IAM 서비스를 검색해서 이동한다.

<br>

2) 왼쪽 메뉴에서 [역할] 메뉴를 클릭하고 [역할 만들기] 버튼을 클릭.

<br>

3) [AWS 서비스]를 선택하고 아래로 내려가면 서비스를 선택할 수 있는데 [CodeDelpoy]를 선택한다.

    ![image](https://github.com/MinnSeoo/Cloud/assets/102645965/dc14741d-73e5-46c1-b1d8-660fdcec14fd)

<br>

4) 3번까지 진행하고 [다음] 버튼을 클릭하면 권한 정책을 확인하는 창이 나온다. 기본적으로 CodeDeploy 서비스에 필요한 [AWSCodeDeployRole]이라는 정책이 추가돼 있는 것을 알 수 있다.
정책이 있는지 확인하고 [다음] 버튼을 클릭한다.

    ![image](https://github.com/MinnSeoo/Cloud/assets/102645965/3e740dad-f36a-4d60-8c83-38806d6387a8)

<br>

5) 역할 이름을 지정하고 [역할 만들기] 버튼을 클릭하여 역할을 생성한다.<br>
   (나는 `test-code-deploy-service` 라는 이름을 지정하였다.)

<br> <br>


### **EC2 인스턴스 역할, 인스턴스 프로파일 생성**

**[진행과정]**

1) IAM 서비스에서 왼쪽 목록에서 **[정책]** 메뉴를 선택하고 **[정책 생성]** 버튼을 클릭한다.

<br>

2) 기본적으로 정책을 더 쉽게 생성할 수 있게 도와주는 시각적 편집기가 선택되어 있지만, 이번 실습에서는 JSON 형식으로 만들어진 정책을 바로 입력하기 위해 **[JSON] 편집기**를 선택해 준다. 그리고 Action 부분에 `s3:Get*` , `s3:List*` 코드를 작성해 주고, Resource 부분에 `"*"` 를 추가해 준다. 이 코드는 S3 버킷에서 객체를 가져온후, 객체 목록을 조회하는 작업을 포함한다. 라는 뜻이다. 입력이 모두 완료되면 [다음] 버튼을 클릭해 준다.

    **(위와 같은 권한을 추가하는 이유는 EC2 인스턴스에 설치된 CodeDeploy Agent가 github나 S3에 업로드된 파일을 가져와야 하기 때문이다.)**

    ![image](https://github.com/MinnSeoo/Cloud/assets/102645965/80b09ffe-db35-4026-9fbf-fd087ad265c2)

<br>

3) 정책 이름과 설명을 입력해 주고 정책을 생성해 준다.

    (나는 `test-code-deploy-ec2-policy` 라는 이름을 지정해 주었다.)

4) IAM 서비스에서 역할을 1개 더 만들어 준다. 이때 [AWS 서비스]에 [EC2]를 선택하고 [다음] 버튼을 클릭하면 권한을 추가하는 창이 뜰건데, 여기서 3번 단계에서 만든 `test-code-deploy-ec2-policy` 를 선택하고 역할을 생성한다.